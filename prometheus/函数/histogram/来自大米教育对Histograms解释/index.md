Histograms

Histogram统计数据的分布情况。比如最小值，最大值，中间值，还有中位数，75百分位, 90
百分位, 95百分位, 98百分位, 99百分位, 和 99.9百分位的值(percentiles)。
这是一种特殊的 metrics数据类型 ， 代表的是一种近似的百分比估算数值 

这个metrics种类 是最难理解的一种（但是很实用估计大多数学员看了上面这几行定义 头
会很大

 大米老师 用一种更简单的方式来给大家做解释一下 什么是 Histogram数据

比如我们在企业⼯作中 经常接触这种数据

`Http_response_time` HTTP响应时间

代表的是 一次用户HTTP请求 在系统传输和执过程中 总共花费的时间
nginx中的  也会记录这一项数值 在日志中
那么问题来了
我们做一个假设
如果我们想通过监控的方式 抓取当天的nginx access_log ，并且想监控用户的访问时间
我们应该怎么做呢？
同学们肯定很容易想到
简单啊 把日志每⾏的 http_response_time 数值统统采集下来啊 然后计算一下总的平均值即可
那么大米要问大家一句了 假如我们采集到 今天一天的访问量 是100万次
然后把这100万次的 http_response_time 全都加一起 然后 除以100万 最后得出来一个avg值
0.05秒 = 50毫秒

这个数据的意义大么？

假如 今天中午1:00的时候 发生了一次线上故障 系统整体的访问变得非常缓慢 大部分的用户
请求时间都达到了 0.5～1秒作用
但是这一段时间 只持续了5分钟， 总的一天的平均值并不能表现得出来  我们如何在1:00-
1:05的时候 实现报警呢？

在举个例子

就算我们一天下来 线上没有发生故障 大部分用户的响应时间 都在 0.05秒（通过 总时间/总
次数得出）

但是我们不要忘了 任何系统中 都一定存在 慢请求 就是有一少部分的用户 请求时间会比总
的平均值大很多 甚至接近 5秒 10秒的也有
（这种情况很普遍 因为各种因素 可能是软件本⾝的bug 也可能是系统的原因 更有可能是少
部分用户的使用途径中出现了问题）
那么我们的监控需要 发现和报警 这种少部分的特殊状况，用总平均能获得吗？
如果采用总平均的方式，那不管发生什么特殊情况，因为大部分的用户响应都是正常的 你
永远也发现不了少部分的问题
所以 Histogram的metrics类型 在这种时候就派上用场了
通过histogram类型（prometheus中 其实提供了一个 基于histogram算法的 函数 可以直接使
用）

可以分别统计出  全部用户的响应时间中

- 0 ~  0.05秒的有多少，
- > 2秒的有多少
- >10秒的有多少

我们就可以很清晰的看到 当前我们的系统中 处于基本正常状态的有多少百分比的用户（或者是请求）
多少处于速度极快的用户， 多少处于慢请求或者有问题的请求